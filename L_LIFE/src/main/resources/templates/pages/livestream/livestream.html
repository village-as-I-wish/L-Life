<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>L-Life Standard</title>
    <th:block th:replace="common/fragment/commonHead"></th:block>

    <script th:inline="javascript">
        var baseUrl = /*[[${baseUrl}]]*/ null;
    </script>

    <link rel="stylesheet" type="text/css" th:href="@{/css/livestream/livestream.css}"/>
    <link rel="stylesheet" th:href="@{/css/livestream/open_vidu_test.css}" type="text/css" media="screen">
    <script th:src="@{/js/livestream/openvidu-browser-2.28.0.js}" type="text/javascript"></script>
    <script th:src="@{/js/livestream/openvidu_testing.js}" type="text/javascript"></script>
    <script th:src="@{/js/livestream/livestream.js}" type="text/javascript"></script>

    <script th:src="@{/js/chat/chat.js}" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.2/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>

</head>
<body>
<div class="livestream-container hd__inner1400">

    <div class="stream-info-box">
        <img alt="라이브 샘플 사진" th:src="@{/img/livestream/livestream_sample.png}" style="display: none;"/>
        <openvidu-webcomponent style="display: none"></openvidu-webcomponent>
        <!--        <div id="video-container" style="border:1px solid red;"></div>-->
        <div id="video-container">
            <div class="video-container-inner">
<!--                <img alt="라이브 샘플 사진" src="https://img-resource.s3.ap-northeast-2.amazonaws.com/Character/character_img10.png?response-content-disposition=inline&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEPv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaDmFwLW5vcnRoZWFzdC0yIkcwRQIgC8WTqJ61XwTDy5PLeXIY7xHRBET9cj3agCipvOMW2RoCIQDTWjKZZ4ClBpH6cCp6%2FAuPqIGvhAqLdzBpZQOkSNxJriqOAwjk%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDIwNjIwNzA0MTEzMyIMvnJJPCCrXZXEAK2tKuICNVsOW5cp8HfB60DVPAATehlmsvPfC4xCxWt1yCe3USkga4dubyK%2FNjpc6ks3E9DvBF4oiIdsQhxL%2B9i7z128b7k1ljxGyCpOxEkrdBuy2udZMxZDkOD25z6nl%2FlWkKebeBfB%2BGqkI6B1LZ6%2BTIQGYRvHLHGeTZJ0WSZOVjTlktLUShkusiu9SgM3Ip%2BuOxYgMt3iKAqf%2FK4hHMIaPbtM6Jl%2B3r1lcg1RL1bu6o34fHOC0JroTqIzO%2FrVc6mHgOmCg8zYHbdaLmigz9eb44QprUz8RP80L5AC8DUvzB%2B0Y1FqiPfQkNdMHoSOPqY6CXXT9j4rx4a7RrCpupO0TUEhKSXmJUq4beuSvtNrszHz3%2BSgDwpKEAb5bxTpQgWEw56tllvDxjoABbuNlSjeyyhZt7KiVZ13bBI7XOLs4aj3bPYO1zlHOsYJuOLUGqxEJHyGkzlNKX0DYa0Ch3v8FVto6Z1hMPPZrqgGOrMCJtwXdVIPlNa1biCXwgbR6QxrZT83tG2q%2FLVLXOgikU9mNsdZdlal6ok9Q4FxPp2zn6Ttm2qFkYqzuAWxtTpFxhWb5%2BrNU6jLFwJH5QD50zKk8uQlLRwzvQsYIK0fjnxj2m3l85YVXT1OFHlaE5Mi7kS23T3w86t78ByoPOPGQpJSdiZmw973pEiKnnGvbR9oGEt6QRHwhkYOVGYoWXxe%2BbJAdJbGKYS2FbZiIpFhcg473jB5S171tKMaORnPSzVfI0aP4grX1zERrMc94e7huubyP%2FK%2BcGwoPNKbl0D9v0wg3lvTCm6PJVBhHZv04%2FDmW7FUtRkdVkwJ8NUFz64mccTIYh0DuAHRdrFqOZD4FE7CgoVSfbFllKChNxmkDZkXC5%2BzoATyji3gTvz%2ByItS%2FIW5kw%3D%3D&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Date=20230921T033235Z&X-Amz-SignedHeaders=host&X-Amz-Expires=300&X-Amz-Credential=ASIATAAXFXZWYJLJE4UO%2F20230921%2Fap-northeast-2%2Fs3%2Faws4_request&X-Amz-Signature=6a5dff99d7747bad42c9dce61508ffbc6f3d54bce2afef046d49b82f2c5f0d47">-->
                <img class="livestream-logo" alt="라이브 샘플 사진" th:src="@{/img/livestream/livestream_logo2.png}" />
                <p class="video-container-inner-txt"> - 방송 시작 전 입니다 - </p>
                <p class="video-container-inner-subtxt"> </p>

            </div>
        </div>

        <div class="stream-info-txt-box">
            <span class="dark-brown"> 오늘 저녁 6시  </span>
            <div class="livestream-name">
                ❤️ 리바트 라이프 LIVE ❤️ 8/27 (일) 주방&욕실 스탠다드 구독!
            </div>
            <div class="livestream-packinfo">
                스탠다드 구독관 편 - L-COIN 5
            </div>
            <div class="livestream-tags">
               <span th:text="${liveStreamDetail.getLStreamTags()}"></span>
            </div>

            <button id="openSession"  class="livestream-sharebtn" name="commit" value="Join!"
                    th:if="${session.existingMember.mIsAdmin == 1}" th:onclick="'joinSession(' + ${session.existingMember.mIsAdmin} + ')'">
                <div class="share-btn-box">
                    <i class="fa-solid fa-share-nodes"></i>
                </div>
                <span class="share-btn-txt">
                    방송 개설하기
                </span>

            </button>

            <button class="livestream-sharebtn" name="commit" value="Join!" th:if="${session.existingMember.mIsAdmin == 0}" th:onclick="'joinSession(' + ${session.existingMember.mIsAdmin} + ')'">
                <div class="share-btn-box">
                    <i class="fa-solid fa-share-nodes"></i>
                </div>
                <span class="share-btn-txt2">
                    방송 입장하기
                </span>
            </button>
        </div>

        <div class="llife-logo-box">
            <img alt="리바트 라이프 로고" th:src="@{/img/livestream/livestream-llifelogo.png}"/>
            <span> 리바트 라이프</span>
        </div>

        <div class="livestream-notice-box">
            <div class="livestream-notice-header"> 방송 공지사항</div>
            <span class="livestream-notice">
                리바트 라이프만의 라이브에서는 구독 패키지 상품을 <br> 기존보다 더욱 저렴하게 구독이 가능합니다. <br>
                리바트 라이브의 패키지 상품은 한정 수량입니다.
                <br><br>
                장바구니 담기 후 코인 결제 완료 시 구독이 확정됩니다.
            </span>
        </div>
    </div>
        <div class="stream-chat-box">
            <i class="fa-solid fa-hourglass-half hourglass" style="color: #c9cbcf;"></i>
            <div id="countdown"></div>
            <p> 채팅은 라이브가 시작되면 참여하실 수 있습니다. </p>
            <p> 라이브가 시작하기 전까지 기다려주세요. </p>

        </div>
    <div class="stream-chat-box-onboard hidden">
        <div class="chat-box" id="msgArea">
            <p class="chat"> <span class="chat-user"> 라이브 MD ⚽️ </span>리바트 라이프 구독 서비스 홍보 라이브 인가요? </p>
            <p class="chat">  <span class="chat-user"> 라이브 MD ⚽️ </span> 할인이 많아서 좋습니다.   </p>
            <p class="chat chat-blue">  <span class="chat-user"> 라이브 MD ⚽️ </span> 라이브 방송 좋아요    </p>

        </div>
        <div class="chat-btn-box">
            <input class="chat-input" id="msg">
            <button class="chat-submit-btn" id="button-send">
                <img alt="라이브 샘플 사진" th:src="@{/img/livestream/livestream_chat_btn.png}"/>
            </button>
        </div>
        <input id="memberName" type="hidden" th:value="${session.existingMember.mName}">
        <input id="lStreamId" type="hidden" th:value="${lStreamId}">
    </div>
    <div class="stream-product-box">
        <div class="stream-product-box-header">
            <p> 판매 상품 </p>
        </div>
        <div class="ad-slide">
            <p> 🔔 패키지 구독 시 각 상품별 코인 1개씩 할인됩니다.🔔</p>
            <p> 🔔 패키지 구독 시 각 상품별 코인 1개씩 할인됩니다.🔔</p>
            <p> 🔔 패키지 구독 시 각 상품별 코인 1개씩 할인됩니다.🔔</p>

        </div>

        <div class="stream-product-name">
            <span class="dark-brown"> 패키지 </span>: <span th:text="${liveStreamDetail.getLfPackage().lfPackageName}"> </span>
        </div>
        <div class="stream-product-price">
            <span class="stream-product-price-txt"> 패키지 구독 코인 :  </span>
            <span> L-life Coin <span th:text="${liveStreamDetail.getLfPackage().getLfPackageStCoin()}">0</span>개 </span>
            <button class="stream-product-cart-btn dark-brown" th:onclick="packageToCart()"> 패키지 담기</button>
        </div>
        <hr>
        <span class="package-info-txt"> 패키지 구성 상품 </span>
        <i class="fa-solid fa-sort-down package-info-i dark-brown"></i>

        <div th:each=" lsProduct, i : ${liveStreamProducts}" class="stream-sub-product-card" th:id="'lsProductCard' + ${i.index}">
            <!-- 장바구니용 정보 -->
            <span class="hidden" th:id="'lsProductCard' + ${i.index} + 'lfId'" th:text="${lsProduct.lfId}"></span>
            <span class="hidden" th:id="'lsProductCard' + ${i.index} + 'lfOptId'" th:text="${lsProduct.lfOptId}"></span>
            <span class="hidden" th:id="'lsProductCard' + ${i.index} + 'lfStCoin'" th:text="${lsProduct.lfStCoin}"></span>

            <img th:if="${lsProduct.lfImgMain != null}" th:src="${lsProduct.lfImgMain}" alt="리바트 라이프 패키지 상품 샘플"/>
            <img th:unless="${lsProduct.lfImgMain != null}" th:src="@{/img/livestream/livestream_product_sample.png}" alt="기본 이미지"/>
            <div class="stream-sub-product">
                <div class="stream-sub-product-name">
                    <div>
                        <span th:text="${lsProduct.lfBrandName}"> 브랜드 </span><span th:text="${lsProduct.lfName}"> 상품 준비중  </span>
                    </div>
                    <p th:utext="'[옵션] ' + ${lsProduct.lfOptName}" th:if="${lsProduct.lfOptName != null}">옵션 준비중</p>
                </div>
                <div class="stream-sub-product-info">
                    <div class="stream-sub-product-coins">
                        <img th:each="coinNum : ${#numbers.sequence(1, lsProduct.lfStCoin)}"
                             class="coin" alt="리바트 라이프 코인" th:src="@{/img/livestream/coin.png}"/>
                    </div>
                    <div class="stream-sub-product-btns">
                        <i class="fa-regular fa-heart fa-xl dark-brown"></i>
                        <button class="stream-sub-product-cart-btn dark-brown" th:onclick="productToCart([[${i.index}]])"> 상품 담기 </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <span class="hidden" id="existingMember" th:text="${session.existingMember.getMId()}"></span>
    <span class="hidden" id="liveStreamPackageId" th:text="${liveStreamDetail.lfPackageId}"></span>
</div>
</body>

<script>
    var targetTime = new Date().getTime() + 5000; // 초기에 한 번 설정

    // 특정 시간까지 남은 시간을 계산하는 함수
    function calculateTimeRemaining(targetTime) {
        var currentTime = new Date().getTime();
        var timeRemaining = targetTime - currentTime;

        var days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
        var hours = Math.floor((timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        var minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
        var seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);

        return {
            days: days,
            hours: hours,
            minutes: minutes,
            seconds: seconds
        };
    }

    // 남은 시간을 화면에 업데이트하는 함수
    function updateCountdown() {
        var timeRemaining = calculateTimeRemaining(targetTime);

        if (timeRemaining.days >= 0) {
            $("#countdown").html(
                "남은 시간: " +
                timeRemaining.days + "일 " +
                timeRemaining.hours + "시간 " +
                timeRemaining.minutes + "분 " +
                timeRemaining.seconds + "초"
            );
        } else {
            $('.stream-chat-box').addClass("hidden")
            $('.stream-chat-box-onboard').removeClass("hidden")
            $('.video-container-inner p:first').text('방송이 시작되었습니다').addClass('text-pink');
            $('.video-container-inner-subtxt').text('하단의 버튼을 통해 입장해주세요.').addClass('text-pink');
            return ;
        }
    }

    setInterval(updateCountdown, 1000);

    $(document).ready(function() {
        updateCountdown();
    });
</script>
</html>