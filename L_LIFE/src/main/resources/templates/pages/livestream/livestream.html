<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>L-Life Standard</title>
    <th:block th:replace="common/fragment/commonHead"></th:block>

    <script th:inline="javascript">
        var baseUrl = /*[[${baseUrl}]]*/ null;
    </script>

    <link rel="stylesheet" type="text/css" th:href="@{/css/livestream/livestream.css}"/>
    <link rel="stylesheet" th:href="@{/css/livestream/open_vidu_test.css}" type="text/css" media="screen">
    <script th:src="@{/js/livestream/openvidu-browser-2.28.0.js}" type="text/javascript"></script>
    <script th:src="@{/js/livestream/openvidu_testing.js}" type="text/javascript"></script>
    <script th:src="@{/js/livestream/livestream.js}" type="text/javascript"></script>
</head>
<body>
<div class="livestream-container hd__inner1400">

    <div class="stream-info-box">
        <img alt="라이브 샘플 사진" th:src="@{/img/livestream/livestream_sample.png}" style="display: none;"/>
        <openvidu-webcomponent style="display: none"></openvidu-webcomponent>
        <!--        <div id="video-container" style="border:1px solid red;"></div>-->
        <div id="video-container"><p></p>
        </div>

        <div class="stream-info-txt-box">
            <span class="dark-brown"> 오늘 저녁 6시  </span>
            <div class="livestream-name">
                ❤️ 리바트 라이프 LIVE ❤️ 8/27 (일) 주방&욕실 스탠다드 구독!
            </div>
            <div class="livestream-packinfo">
                스탠다드 구독관 편 - L-COIN 5
            </div>
            <div class="livestream-tags">
               <span th:text="${liveStreamDetail.getLStreamTags()}"></span>
            </div>

            <button id="openSession"  class="livestream-sharebtn" name="commit" value="Join!"
                    th:if="${session.existingMember.mIsAdmin == 1}" th:onclick="'joinSession(' + ${session.existingMember.mIsAdmin} + ')'">
                <div class="share-btn-box">
                    <i class="fa-solid fa-share-nodes"></i>
                </div>
                <span class="share-btn-txt">
                    방송 개설하기
                </span>

            </button>

            <button className="livestream-sharebtn" name="commit" value="Join!" th:if="${session.existingMember.mIsAdmin == 0}" th:onclick="'joinSession(' + ${session.existingMember.mIsAdmin} + ')'">
                <div class="share-btn-box">
                    <i class="fa-solid fa-share-nodes"></i>
                </div>
                <span class="share-btn-txt2">
                    방송 입장하기
                </span>
            </button>
        </div>

        <div class="llife-logo-box">
            <img alt="리바트 라이프 로고" th:src="@{/img/livestream/livestream-llifelogo.png}"/>
            <span> 리바트 라이프</span>
        </div>

        <div class="livestream-notice-box">
            <div class="livestream-notice-header"> 방송 공지사항</div>
            <span class="livestream-notice">
                리바트 라이프만의 라이브에서는 구독 패키지 상품을 <br> 기존보다 더욱 저렴하게 구독이 가능합니다. <br>
                리바트 라이브의 패키지 상품은 한정 수량입니다.
                <br><br>
                장바구니 담기 후 포인트 결제 완료 시 구독이 확정됩니다.
            </span>
        </div>
    </div>
        <div class="stream-chat-box">
            <i class="fa-solid fa-hourglass-half hourglass" style="color: #c9cbcf;"></i>
            <div id="countdown"></div>
            <p> 채팅은 라이브가 시작되면 참여하실 수 있습니다. </p>
            <p> 라이브가 시작하기 전까지 기다려주세요. </p>

        </div>
    <div class="stream-chat-box-onboard hidden">
        <div class="chat-box">
            <p class="chat"><span class="chat-user"> 라이브 MD ⚽️ </span>리바트 라이프 구독 서비스 홍보 라이브 인가요? </p>
            <p class="chat"><span class="chat-user"> 라이브 MD ⚽️ </span> 할인이 많아서 좋습니다. </p>
            <p class="chat chat-blue"><span class="chat-user"> 라이브 MD ⚽️ </span> 라이브 방송 좋아요 </p>

        </div>
        <div class="chat-btn-box">
            <input class="chat-input">
            <button class="chat-submit-btn">
                <img alt="라이브 샘플 사진" th:src="@{/img/livestream/livestream_chat_btn.png}"/>

            </button>
        </div>
    </div>
    <div class="stream-product-box">
        <div class="stream-product-box-header">
            <p> 판매 상품 </p>
        </div>

        <div class="stream-product-name">
            <span class="dark-brown"> 패키지 상품명 </span>: <span th:text="${liveStreamDetail.getLfPackage().lfPackageName}"> </span>
        </div>
        <div class="stream-product-price">
            <span class="stream-product-price-txt"> 판매 ( 할인 ) 코인 :  </span>
            <span> L-life Coin <span th:text="${liveStreamDetail.getLfPackage().getLfPackageStCoin()}">0</span>개 </span>
            <button class="stream-product-cart-btn dark-brown" th:onclick="packageToCart()"> 패키지 담기</button>
        </div>
        <hr>
        <span class="package-info-txt"> 패키지 구성 상품 </span>
        <i class="fa-solid fa-sort-down package-info-i dark-brown"></i>

        <div th:each=" lsProduct, i : ${liveStreamProducts}" class="stream-sub-product-card" th:id="'lsProductCard' + ${i.index}">
            <!-- 장바구니용 정보 -->
            <span class="hidden" th:id="'lsProductCard' + ${i.index} + 'lfId'" th:text="${lsProduct.lfId}"></span>
            <span class="hidden" th:id="'lsProductCard' + ${i.index} + 'lfOptId'" th:text="${lsProduct.lfOptId}"></span>
            <span class="hidden" th:id="'lsProductCard' + ${i.index} + 'lfStCoin'" th:text="${lsProduct.lfStCoin}"></span>

            <img th:if="${lsProduct.lfImgMain != null}" th:src="${lsProduct.lfImgMain}" alt="리바트 라이프 패키지 상품 샘플"/>
            <img th:unless="${lsProduct.lfImgMain != null}" th:src="@{/img/livestream/livestream_product_sample.png}" alt="기본 이미지"/>
            <div class="stream-sub-product">
                <div class="stream-sub-product-name">
                    <div>
                        <span th:text="${lsProduct.lfBrandName}"> 브랜드 </span><span th:text="${lsProduct.lfName}"> 상품 준비중  </span>
                    </div>
                    <p th:utext="'[옵션] ' + ${lsProduct.lfOptName}" th:if="${lsProduct.lfOptName != null}">옵션 준비중</p>
                </div>
                <div class="stream-sub-product-info">
                    <div class="stream-sub-product-coins">
                        <img th:each="coinNum : ${#numbers.sequence(1, lsProduct.lfStCoin)}"
                             class="coin" alt="리바트 라이프 코인" th:src="@{/img/livestream/coin.png}"/>
                    </div>
                    <div class="stream-sub-product-btns">
                        <i class="fa-regular fa-heart fa-xl dark-brown"></i>
                        <button class="stream-sub-product-cart-btn dark-brown" th:onclick="productToCart([[${i.index}]])"> 상품 담기 </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <span class="hidden" id="existingMember" th:text="${session.existingMember.getMId()}"></span>
    <span class="hidden" id="liveStreamPackageId" th:text="${liveStreamDetail.lfPackageId}"></span>
</div>
</body>

<script>
    var targetTime = new Date().getTime() + 10000; // 초기에 한 번 설정

    // 특정 시간까지 남은 시간을 계산하는 함수
    function calculateTimeRemaining(targetTime) {
        var currentTime = new Date().getTime();
        var timeRemaining = targetTime - currentTime;

        var days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
        var hours = Math.floor((timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        var minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
        var seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);

        return {
            days: days,
            hours: hours,
            minutes: minutes,
            seconds: seconds
        };
    }

    // 남은 시간을 화면에 업데이트하는 함수
    function updateCountdown() {
        var timeRemaining = calculateTimeRemaining(targetTime);

        if (timeRemaining.days >= 0) {
            $("#countdown").html(
                "남은 시간: " +
                timeRemaining.days + "일 " +
                timeRemaining.hours + "시간 " +
                timeRemaining.minutes + "분 " +
                timeRemaining.seconds + "초"
            );
        } else {
            $('.stream-chat-box').addClass("hidden")
            $('.stream-chat-box-onboard').removeClass("hidden")

        }
    }

    setInterval(updateCountdown, 1000);

    $(document).ready(function() {
        updateCountdown();
    });
</script>
</html>