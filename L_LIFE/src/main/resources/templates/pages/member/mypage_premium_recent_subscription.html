<html xmlns:th="http://www.thymeleaf.org">

<th:block th:fragment="mypagePremiumRecentSubscription()">
    <link rel="stylesheet" th:href="@{/css/member/mypage_premium_recent_subscription.css}">
    <link rel="stylesheet" th:href="@{/css/common/reset.css}">
    <link rel="stylesheet" href="https://unpkg.com/js-datepicker/dist/datepicker.min.css">

    <div class="subscribe-title">최근 구독 내역</div>
    <div class="date-select">
        <div class="date-select-wrap">
            <span class="time-select" onclick="setMonth(1)">1개월</span>
            <span class="time-select" onclick="setMonth(3)">3개월</span>
            <span class="time-select" onclick="setMonth(6)">6개월</span>
            <span class="time-select" onclick="setMonth(12)">1년</span>
        </div>

        <div class="date-input-wrap">
            <div class="date-input" id="startDateDiv">
                <span class="date-text" id="startDate"></span>
                <img th:src="@{/img/member/calender.png}" alt="calendar icon" class="calendar-icon" onclick="openDatePicker('startDate')">
            </div>
            ~
            <div class="date-input" id="endDateDiv">
                <span class="date-text" id="endDate"></span>
                <img th:src="@{/img/member/calender.png}" alt="calendar icon" class="calendar-icon" onclick="openDatePicker('endDate')">
            </div>
            <button type="button" id="btnNewOrder" class="datepicker-search" onclick="goNewPage(1);">검색하기</button>
        </div>
    </div>

    <!-- 프리미엄 테이블 부분 -->
    <table class="recent-table">
        <colgroup>
            <col style="width: 25%">
            <col style="width: 50%">
            <col style="width: 25%">
        </colgroup>
        <thead>
        <tr>
            <th class="col-title">주문일</th>
            <th class="col-title">구독항목</th>
            <th class="col-title">월구독가격</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="product : ${products}">
            <td th:text="${product.date}"></td>
            <td>
                <div class="product-info">
                    <img class="product-img" th:src="@{'/img/member/' + ${product.image}}">
                    <div class="product-details">
                        <span th:text="${product.name}"></span>
                    </div>
                </div>
            </td>
            <td th:text="${product.price} + '원'"></td>
        </tr>
        </tbody>
    </table>

    <script src="https://unpkg.com/js-datepicker"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            setDefaultDates();
            initDatepickers();
        });


        function setDefaultDates() {
            let today = new Date();
            let oneMonthAgo = new Date(today);
            oneMonthAgo.setMonth(today.getMonth() - 1);

            document.getElementById("startDate").innerHTML = formatDate(oneMonthAgo);
            document.getElementById("endDate").innerHTML = formatDate(today);
        }

        function formatDate(date) {
            let dd = date.getDate();
            let mm = date.getMonth() + 1;
            let yyyy = date.getFullYear();

            if (dd < 10) {
                dd = '0' + dd;
            }

            if (mm < 10) {
                mm = '0' + mm;
            }

            return yyyy + '.' + mm + '.' + dd;
        }


        function setMonth(monthsAgo) {
            let today = new Date();
            let pastDate = new Date(today);
            pastDate.setMonth(today.getMonth() - monthsAgo);

            document.getElementById("startDate").innerHTML = formatDate(pastDate);
            document.getElementById("endDate").innerHTML = formatDate(today);
        }

        let startDatePicker, endDatePicker;

        function initDatepickers() {
            const startDateDiv = document.getElementById('startDateDiv');
            const endDateDiv = document.getElementById('endDateDiv');

            startDatePicker = datepicker(startDateDiv, {
                onSelect: (instance, date) => {
                    document.getElementById("startDate").textContent = formatDate(date);
                }
            });

            endDatePicker = datepicker(endDateDiv, {
                onSelect: (instance, date) => {
                    document.getElementById("endDate").textContent = formatDate(date);
                }
            });
        }

        function openDatePicker(id) {
            if (id === 'startDate') {
                startDatePicker.show();
            } else if (id === 'endDate') {
                endDatePicker.show();
            }
        }
    </script>
</th:block>
</html>
